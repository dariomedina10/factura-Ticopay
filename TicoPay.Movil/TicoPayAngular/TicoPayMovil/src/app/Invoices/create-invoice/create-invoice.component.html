<div class="container text-center">
  <app-loader></app-loader>
</div>
<div class="loader-screen" *ngIf="_procesando"></div>
<form autocomplete="off" novalidate #createInvoiceForm="ngForm" (ngSubmit)="submitInvoiceInformation(createInvoiceForm)"
  [hidden]="_procesando" class="form-horizontal" role="form">
  <div class="form-group hidden-md hidden-sm hidden-lg">
    <div class="col-md-7 text-center">
        <label class="control-label" for="comprobanteElectronicoType">Crear Comprobante Electrónico</label>
    </div>
    <div class="col-md-5 text-center">
      <select #comprobanteElectronicoType="ngModel" name="comprobanteElectronicoType" id="comprobanteElectronicoType" class="form-control" required [(ngModel)]="_comprobanteType"
        class="form-control">
        <option [ngValue]="tipoDocumento.Invoice">Factura Electrónica</option>
        <option [ngValue]="tipoDocumento.Ticket">Tiquete Electrónico</option>
      </select>
    </div>
  </div>
  <div class="form-group hidden-xs">
    <div class="col-xs-12 text-center">
        <label class="control-label" for="comprobanteElectronicoType">Crear Comprobante Electrónico</label>
    </div>    
  </div>
  <div class="form-group hidden-xs">    
    <div class="col-xs-12 text-center">
      <select #comprobanteElectronicoType="ngModel" name="comprobanteElectronicoType" id="comprobanteElectronicoType" class="form-control" required [(ngModel)]="_comprobanteType"
        class="form-control">
        <option [ngValue]="tipoDocumento.Invoice">Factura Electrónica</option>
        <option [ngValue]="tipoDocumento.Ticket">Tiquete Electrónico</option>
      </select>
    </div>
  </div>
  <div class="panel-group" id="accordion">
    <div class="panel panel-default">
      <div class="panel-heading text-center">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" data-target="#panelCliente" href="#panelCliente" onclick="return false;">
            <span class="glyphicon glyphicon-user"></span> Cliente a facturar</a>
        </h4>
      </div>
      <div id="panelCliente" class="panel-collapse collapse indent">
        <div class="panel-body">
          <!-- Contenido del Panel -->
          <div>
            <div class="form-group">
              <div class="col-xs-8 col-md-10 text-right">
                <label class="control-label" for="cswitch">
                  <span class="glyphicon glyphicon-filter"></span> Filtrar</label>
              </div>
              <div class="col-xs-4 col-md-2 align-center-middle text-left">
                <label class="switch" id="cswitch">
                  <input type="checkbox" #filtroCliente="ngModel" name="filtroCliente" [(ngModel)]='_filtroCliente'>
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
            <div *ngIf="_filtroCliente" class="form-group">
              <div class="col-xs-5 col-md-2 text-right align-center-middle text-right">
                <label class="control-label" for="cFilter">Nombre o Nº Identificación </label>
              </div>
              <div class="col-xs-7 col-md-10 align-center-middle">
                <input #cFilter="ngModel" name="cFilter" [(ngModel)]='_clientFilter' (change)='clientFilterChange()' type="text" class="form-control"
                />
              </div>
            </div>
            <div class="form-group">
              <div *ngIf="_filtroCliente" class="col-xs-12 col-md-12 text-right">
                <label class="control-label" for="clientID">Seleccione un cliente (Filtrado por {{_clientFilter}}) </label>
              </div>
              <div *ngIf="!_filtroCliente" class="col-xs-12 col-md-12 text-right">
                <label class="control-label" for="clientID">Seleccione un cliente </label>
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-12 col-md-12 align-center-middle">
                <select #clientId="ngModel" name="clientId" class="form-control" id="clientID" [(ngModel)]="_clientId" 
                (change)='onSelectedClientChange()' [required]="_comprobanteType == tipoDocumento.Invoice">
                  <option disabled selected [ngValue]="undefined"> Seleccione ... </option>
                  <option *ngFor='let client of _filteredClients' [value]="client.id">{{client.name}} {{client.lastName | formatCell : true}}</option>
                </select>
              </div>
            </div>
            <div *ngIf="_comprobanteType == tipoDocumento.Ticket">
                <div class="form-group">
                    <div class="col-xs-12 col-md-12 text-left">
                      <label for="clientName" class="control-label">Nombre Completo</label>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="col-xs-12 col-md-12 text-center">
                      <input #clientName="ngModel" name="clientName" id="clientName" minlength="2" maxlength="80" [(ngModel)]='_invoice.ClientName' type="text"
                        placeholder="ej. Pedro Perez" class="form-control" />
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="col-xs-12 col-md-12 text-left">
                      <label for="clientIdentificationType" class="control-label">Tipo de Identificación</label>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="col-xs-12 col-md-12 text-center">
                      <select #clientIdentificationType="ngModel" name="clientIdentificationType" id="clientIdentificationType" class="form-control"
                        [(ngModel)]="_invoice.ClientIdentificationType" class="form-control">
                        <option [ngValue]="identificationType.CedulaFisica">Cedula Física</option>
                        <option [ngValue]="identificationType.CedulaJuridica">Cedula Jurídica</option>
                        <option [ngValue]="identificationType.DIMEX">DIMEX</option>
                        <option [ngValue]="identificationType.NITE">NITE</option>
                        <option [ngValue]="identificationType.NoAsiganda">Extranjero</option>
                      </select>
                    </div>
                  </div>
                  <div *ngIf="_invoice.ClientIdentificationType < 4">
                      <div class="form-group">
                        <div class="col-xs-12 col-md-12 text-left">
                          <label for="clientIdentification" class="control-label">Número de Identificación</label>
                        </div>
                      </div>
                      <div class="form-group">
                        <div class="col-xs-12 col-md-12 text-center">
                          <input #clientIdentification="ngModel" name="clientIdentification" id="clientIdentification" minlength="9" maxlength="12"
                            pattern="[0-9]{9,12}" [(ngModel)]='_invoice.ClientIdentification' type="text" placeholder="ej. 123456789 (No digite guiones ni espacios)"
                            class="form-control" />
                        </div>
                        <div class="col-xs-12 col-md-12 text-center">
                          <div *ngIf="clientIdentification.invalid && (clientIdentification.dirty || clientIdentification.touched)" class="alert alert-danger">
                            <div [hidden]="!clientIdentification.errors.pattern">
                              El número de identificación debe llevar solo caracteres numéricos, debe tener 9 dígitos para la cedula física, 10 dígitos
                              para la cedula jurídica o el Nite, y 11 a 12 para el Dimex.
                            </div>
                          </div>
                        </div>
                      </div>
                  </div>
                  <div *ngIf="_invoice.ClientIdentificationType === 4">
                      <div class="form-group">
                        <div class="col-xs-12 col-md-12 text-left">
                          <label for="clientIdentificationExtranjero" class="control-label">Número de identificación extrajera</label>
                        </div>
                      </div>
                      <div class="form-group">
                        <div class="col-xs-12 col-md-12 text-center">
                          <input #clientIdentificationExtranjero="ngModel" name="clientIdentificationExtranjero" id="clientIdentificationExtranjero"
                            minlength="3" maxlength="20" pattern="[a-zA-Z0-9]+" [(ngModel)]='_invoice.ClientIdentification' type="text"
                            placeholder="ej. E123456789 (No digite guiones ni espacios)" class="form-control" />
                        </div>
                        <div class="col-xs-12 col-md-12 text-center">
                          <div *ngIf="clientIdentificationExtranjero.invalid && (clientIdentificationExtranjero.dirty || clientIdentificationExtranjero.touched)"
                            class="alert alert-danger">
                            <div [hidden]="!clientIdentificationExtranjero.errors.pattern">
                              El número de identificación extranjera debe llevar solo caracteres alfanuméricos y debe tener un máximo de 20 dígitos.
                            </div>
                            <div [hidden]="!clientIdentificationExtranjero.errors.minlength">
                              El número de identificación extranjera debe tener un mínimo de 3 dígitos.
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                        <div class="col-xs-12 col-md-12 text-left">
                          <label for="clientEmail" class="control-label">Correo Electrónico</label>
                        </div>
                      </div>
                      <div class="form-group">
                        <div class="col-xs-12 col-md-12 text-center">
                          <input #clientEmail="ngModel" name="clientEmail" id="clientEmail" [(ngModel)]='_invoice.ClientEmail' maxlength="100" type="email"
                            placeholder="ej. alguien@ejemplo.com" class="form-control" pattern="[a-zA-Z][\w+.-]+@[\w+.-]+\.[a-zA-Z0-9]{2,5}$" 
                          />
                        </div>
                      </div>
            </div>
            <div class="form-group">
              <div class="col-xs-12 col-md-12 text-right" *ngIf="!_newClient">
                <button type="button" title="+ Crear cliente" class="btn btn-default btn-responsive" (click)="addClient()">
                  <span class="glyphicon glyphicon-plus"></span> Crear cliente</button>
              </div>
              <div class="col-xs-12 col-md-12 text-right" *ngIf="_newClient">
                <button type="button" title="Cancelar" class="btn btn-default btn-responsive" (click)="addClient()">
                  <span class="glyphicon glyphicon-remove"></span> Cancelar</button>
              </div>
            </div>
            <div class="form-group" *ngIf="_newClient">
              <app-create-quickclient (notifyClientCreated)='onClientCreated($event)'></app-create-quickclient>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading text-center">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" data-target="#panelServicio" href="#panelServicio" onclick="return false;">
            <span class="glyphicon glyphicon-paperclip"></span> Detalle del comprobante</a>
        </h4>
      </div>
      <div id="panelServicio" class="panel-collapse collapse indent">
        <div class="panel-body">
          <!-- Inicio Contenido del Panel -->
          <div>
            <!-- Inicio Controles de Selección y Filtrado -->
            <div class="form-group">
              <div class="col-xs-5 col-md-2 text-right">
                <label class="control-label" for="invoiceFirmType"> Tipo de Firma : </label>
              </div>
              <div class="col-xs-7 col-md-10" *ngIf="_TenantFirmType == 2">
                <select #invoiceFirmType="ngModel" name="invoiceFirmType" id="invoiceFirmType" class="form-control" required [(ngModel)]="_invoiceFirmType"
                  class="form-control">
                  <option [ngValue]="firmType.Llave">Llave Criptográfica</option>
                  <option [ngValue]="firmType.Firma">Firma Digital</option>
                </select>
              </div>
              <div class="col-xs-7 col-md-10" *ngIf="_TenantFirmType == 0">
                <select #invoiceFirmType="ngModel" name="invoiceFirmType" id="invoiceFirmType" class="form-control" required [(ngModel)]="_invoiceFirmType"
                  class="form-control">
                  <option [ngValue]="firmType.Llave">Llave Criptográfica</option>
                </select>
              </div>
              <div class="col-xs-7 col-md-10" *ngIf="_TenantFirmType == 1">
                <select #invoiceFirmType="ngModel" name="invoiceFirmType" id="invoiceFirmType" class="form-control" required [(ngModel)]="_invoiceFirmType"
                  class="form-control">
                  <option [ngValue]="firmType.Firma">Firma Digital</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-5 col-md-2 text-right">
                <label class="control-label" for="invoiceMoneyType"> Moneda : </label>
              </div>
              <div class="col-xs-7 col-md-10">
                <select #invoiceMoneyType="ngModel" name="invoiceMoneyType" id="invoiceMoneyType" class="form-control" required [(ngModel)]="_invoiceMoneyType"
                  class="form-control" (change)="onSelectedMoneyChange()">
                  <option [ngValue]="moneda.CRC">CRC</option>
                  <option [ngValue]="moneda.USD">USD</option>
                </select>
              </div>
            </div>
            <div class="form-group">              
              <div class="col-xs-6 col-md-6 text-center">
                <button type="button" *ngIf="!_newService" title="+ Crear servicio" class="btn btn-default btn-responsive" (click)="addNewService()">
                  <span class="glyphicon glyphicon-plus"></span> Crear Servicio</button>
                <button type="button" *ngIf="_newService" title="+ Crear servicio" class="btn btn-default btn-responsive" (click)="addNewService()">
                  <span class="glyphicon glyphicon-remove"></span> Cancelar</button>
              </div>
              <div class="col-xs-6 col-md-6 text-center">
                <button type="button" *ngIf="!_newProduct" title="+ Crear Producto" class="btn btn-default btn-responsive" (click)="addNewProduct()">
                  <span class="glyphicon glyphicon-plus"></span> Crear Producto</button>
                <button type="button" *ngIf="_newProduct" title="+ Crear Producto" class="btn btn-default btn-responsive" (click)="addNewProduct()">
                  <span class="glyphicon glyphicon-remove"></span> Cancelar</button>
              </div>
            </div>
            <div class="form-group" *ngIf="_newService">
              <!-- Inicio Agregar servicio rápido -->
              <app-create-quickservice (notifyServiceCreated)='onServiceCreated($event)'></app-create-quickservice>
              <!-- Fin Agregar servicio rápido -->
            </div>
            <div class="form-group" *ngIf="_newProduct">
              <!-- Inicio Agregar producto rápido -->
              <app-create-quickproduct (notifyProductCreated)='onProductCreated($event)'></app-create-quickproduct>
              <!-- Fin Agregar producto rápido -->
            </div>
            <div class="form-group">
              <div class="col-xs-8 col-md-10 text-right">
                <label class="control-label" for="sswitch">
                  <span class="glyphicon glyphicon-filter"></span> Filtrar</label>
              </div>
              <div class="col-xs-4 col-md-2 text-left">
                <label class="switch" id="sswitch">
                  <input type="checkbox" #filtroItem="ngModel" name="filtroItem" [(ngModel)]='_filtroItem' (change)='itemFilterChange()'>
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
            <div *ngIf="_filtroItem" class="form-group">
              <div class="col-xs-3 col-md-1 text-right">
                <label class="control-label align-middle" for="sFilter">Nombre </label>
              </div>
              <div class="col-xs-9 col-md-11">
                <input #sFilter="ngModel" name="sFilter" [(ngModel)]='_itemFilter' (change)='itemFilterChange()' type="text" class="form-control"
                />
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-12 col-md-12 text-center">
                <label *ngIf="_filtroItem" class="control-label" for="itemId">Seleccione un item (Filtrado por {{_itemFilter}}) </label>
                <label *ngIf="!_filtroItem" class="control-label" for="itemId">Seleccione un item </label>
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-10 col-md-11 text-right">
                <select #itemId="ngModel" name="itemId" id="itemID" [(ngModel)]="_itemId" class="form-control" (change)="onSelectedItemChange()"
                  [disabled]="_serviceLock">
                  <option disabled selected [ngValue]="undefined"> Seleccione ... </option>
                  <option *ngFor='let item of _filteredItems' [value]="item.Id">{{item.Name}}</option>
                </select>
              </div>
              <div class="col-xs-2 col-md-1 text-right">
                <button type="button" class="btn btn-default btn-responsive" (click)="onUnlockServiceClicked()">
                  <span class="glyphicon glyphicon-remove"></span>
                </button>
              </div>
            </div>
            <div class="form-group" *ngIf="!_serviceLock">
              <div class="col-xs-12 col-md-12 text-center">
                <label>Detalle de la Linea:</label>
              </div>
              <div class="col-xs-12 col-md-12 text-right">
                <input type="text" #serviceTitle="ngModel" name="serviceTitle" id="serviceTitle" [(ngModel)]="_serviceTitle" class="form-control"
                  [disabled]="_serviceLock" maxlength="79"/>
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-12 col-md-12 text-center">
                <label>Descripción de la Linea:</label>
              </div>
              <div class="col-xs-12 col-md-12 text-right">
                <input type="text" #serviceNote="ngModel" name="serviceNote" id="serviceNote" [(ngModel)]="_serviceNote" class="form-control"
                maxlength="199"
                />
              </div>
            </div>
            <div class="form-group" *ngIf="!_serviceLock">
              <div class="col-xs-12 col-md-12 text-center">
                <label>Unidad de Medida:</label>
              </div>
              <div class="col-xs-12 col-md-12 text-right">
                <select #invoiceMoneyType="ngModel" name="serviceMeasurementUnit" id="serviceMeasurementUnit" class="form-control" [(ngModel)]="_serviceMeasurementUnit"
                  class="form-control" [disabled]="_serviceLock">
                  <option [ngValue]="unitMeasurement.ServiciosProfesionales">Servicios Profesionales</option>
                  <option value="{{unitMeasurement.Amperio}}">Amperio</option>
                  <option value="{{unitMeasurement.AmperioXMetro}}">Amperios por Metro</option>
                  <option value="{{unitMeasurement.AmperioXMetroCuadrado}}">Amperio por Metro Cuadrado</option>
                  <option value="{{unitMeasurement.AnguloGrado}}">Angulo Grado</option>
                  <option value="{{unitMeasurement.AnguloMinuto}}">Angulo Minuto</option>
                  <option value="{{unitMeasurement.AnguloSegundo}}">Angulo Segundo</option>
                  <option value="{{unitMeasurement.Barn}}">Barn</option>
                  <option value="{{unitMeasurement.Becquere}}">Becquere</option>
                  <option value="{{unitMeasurement.Candela}}">Candela</option>
                  <option value="{{unitMeasurement.CandelaXMetroCuadrado}}">Candela por Metro Cuadrado</option>
                  <option value="{{unitMeasurement.Centimetro}}">Centimetro</option>
                  <option value="{{unitMeasurement.Coulomb}}">Coulomb</option>
                  <option value="{{unitMeasurement.CoulombXKilogramo}}">Coulomb por Kilogramo</option>
                  <option value="{{unitMeasurement.CoulombXMetroCubico}}">Coulomb por Metro Cubico</option>
                  <option value="{{unitMeasurement.CoulombXMetroCuadrado}}">Coulomb por Metro Cuadrado</option>
                  <option value="{{unitMeasurement.Decibel}}">Decibel</option>
                  <option value="{{unitMeasurement.Dia}}">Dia</option>
                  <option value="{{unitMeasurement.ElectronVoltio}}">Electron Voltio</option>
                  <option value="{{unitMeasurement.EsteRadian}}">EsteRadian</option>
                  <option value="{{unitMeasurement.Faradios}}">Faradios</option>
                  <option value="{{unitMeasurement.FaradioXMetro}}">Faradio por Metro</option>
                  <option value="{{unitMeasurement.Gal}}">Gal</option>            
                  <option value="{{unitMeasurement.GradosCentigrados}}">Grados Centigrados</option>
                  <option value="{{unitMeasurement.GradosKelvin}}">Grados Kelvin</option>
                  <option value="{{unitMeasurement.Gramos}}">Gramos</option>
                  <option value="{{unitMeasurement.Gray}}">Gray</option>
                  <option value="{{unitMeasurement.GrayXSegundo}}">Gray por Segundo</option>            
                  <option value="{{unitMeasurement.Henry}}">Henry</option>
                  <option value="{{unitMeasurement.HenryXMetro}}">Henry por Metro</option>
                  <option value="{{unitMeasurement.Hercio}}">Hercio</option>
                  <option value="{{unitMeasurement.Hora}}">Hora</option>
                  <option value="{{unitMeasurement.Joule}}">Joule</option>
                  <option value="{{unitMeasurement.JouleXKelvin}}">Joule por Kelvin</option>
                  <option value="{{unitMeasurement.JouleXKilogramo}}">Joule por Kilogramo</option>
                  <option value="{{unitMeasurement.JouleXKilogramoKelvin}}">Joule por Kilogramo Kelvin</option>
                  <option value="{{unitMeasurement.JouleXMetroCubico}}">Joule por Metro Cubico</option>
                  <option value="{{unitMeasurement.JouleXMol}}">Joule por Mol</option>
                  <option value="{{unitMeasurement.JouleXMolKelvin}}">Joule por Mol Kelvin</option>
                  <option value="{{unitMeasurement.Katal}}">Katal</option>
                  <option value="{{unitMeasurement.KatalXMetroCubico}}">Katal por Metro Cubico</option>
                  <option value="{{unitMeasurement.Kilogramo}}">Kilogramo</option>
                  <option value="{{unitMeasurement.KilogramoMetroCubico}}">Kilogramo por Metro Cubico</option>
                  <option value="{{unitMeasurement.Kilometro}}">Kilometro</option>
                  <option value="{{unitMeasurement.Litro}}">Litro</option>
                  <option value="{{unitMeasurement.Lumen}}">Lumen</option>
                  <option value="{{unitMeasurement.Lux}}">Lux</option>
                  <option value="{{unitMeasurement.Metro}}">Metros</option>
                  <option value="{{unitMeasurement.MetroCuadrado}}">Metro Cuadrado</option>            
                  <option value="{{unitMeasurement.MetroCubico}}">Metro Cubico</option>
                  <option value="{{unitMeasurement.MetrosXSegundo}}">Metros por Segundo</option>
                  <option value="{{unitMeasurement.MetrosXSegundoCuadrado}}">Metros por Segundo Cuadrado</option>
                  <option value="{{unitMeasurement.MiliLitro}}">MiliLitro</option>
                  <option value="{{unitMeasurement.Milimetro}}">Milimetro</option>
                  <option value="{{unitMeasurement.Minuto}}">Minuto</option>
                  <option value="{{unitMeasurement.Moles}}">Moles</option>
                  <option value="{{unitMeasurement.MolXMetroCubico}}">Mol por Metro Cubico</option>            
                  <option value="{{unitMeasurement.Newton}}">Newton</option>
                  <option value="{{unitMeasurement.NewtonMetro}}">Newton Metro</option>
                  <option value="{{unitMeasurement.NewtonXMetro}}">Newton por Metro</option>
                  <option value="{{unitMeasurement.NumeroOndas}}">Numero Ondas</option>
                  <option value="{{unitMeasurement.Ohmios}}">Ohmios</option>
                  <option value="{{unitMeasurement.Onza}}">Onza</option>
                  <option value="{{unitMeasurement.Pascal}}">Pascal</option>
                  <option value="{{unitMeasurement.PascalSegundo}}">Pascal Segundo</option>
                  <option value="{{unitMeasurement.Pulgada}}">Pulgada</option>
                  <option value="{{unitMeasurement.Radian}}">Radian</option>
                  <option value="{{unitMeasurement.RadianXSegundo}}">Radian por Segundo</option>
                  <option value="{{unitMeasurement.RadianXSegundoCuadrado}}">Radian por Segundo Cuadrado</option>
                  <option value="{{unitMeasurement.Segundo}}">Segundo</option>
                  <option value="{{unitMeasurement.Siemens}}">Siemens</option>
                  <option value="{{unitMeasurement.Sievert}}">Sievert</option>
                  <option value="{{unitMeasurement.Tesla}}">Tesla</option>
                  <option value="{{unitMeasurement.Tonelada}}">Tonelada</option>
                  <option value="{{unitMeasurement.Unidad}}">Unidad</option>
                  <option value="{{unitMeasurement.UnidadAstronomica}}">Unidad Astronomica</option>
                  <option value="{{unitMeasurement.UnidadMasaAtomica}}">Unidad de Masa Atomica</option>
                  <option value="{{unitMeasurement.Uno}}">Uno</option>
                  <option value="{{unitMeasurement.Vatios}}">Vatios</option>
                  <option value="{{unitMeasurement.VatioXEsteRadian}}">Vatio por EsteRadian</option>
                  <option value="{{unitMeasurement.VatioXEsteRadianMetroCuadrado}}">Vatio por EsteRadian Metro Cuadrado</option>
                  <option value="{{unitMeasurement.VatiosXMetroCuadrado}}">Vatios por Metro Cuadrado</option>
                  <option value="{{unitMeasurement.VatioXMetroKelvin}}">Vatio por Metro Kelvin</option>
                  <option value="{{unitMeasurement.Voltios}}">Voltios</option>            
                  <option value="{{unitMeasurement.VoltioXMetro}}">Voltio por Metro</option>
                  <option value="{{unitMeasurement.Weber}}">Weber</option>
                  <option [ngValue]="unitMeasurement.Otros">Otros</option>
                </select>
              </div>
            </div>
            <div class="form-group" *ngIf="!_serviceLock && (_serviceMeasurementUnit == unitMeasurement.Otros)">
              <div class="col-xs-12 col-md-12 text-center">
                <label>Unidad de Medida Personalizada:</label>
              </div>
              <div class="col-xs-12 col-md-12 text-right">
                <input type="text" #serviceMeasurementUnitOther="ngModel" name="serviceMeasurementUnitOther" id="serviceMeasurementUnitOther"
                  [(ngModel)]="_serviceMeasurementUnitOther" class="form-control" [disabled]="_serviceLock" />
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-5 col-md-2 text-right">
                <label for="servicePrice" class="control-label">Precio : </label>
              </div>
              <div class="col-xs-7 col-md-10">
                <input #servicePrice="ngModel" name="servicePrice" id="servicePrice" [(ngModel)]='_servicePrice' type="number" placeholder="Precio del servicio prestado"
                  class="form-control" (keypress)="onDecimalValueChange($event)" />
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-5 col-md-2 text-right">
                <label for="serviceQuantity" class="control-label">Cantidad : </label>
              </div>
              <div class="col-xs-7 col-md-10">
                <input #serviceQuantity="ngModel" name="serviceQuantity" id="serviceQuantity" [(ngModel)]='_serviceQuantity' type="number"
                  placeholder="Cantidad de servicios prestados" class="form-control" (keypress)="onDecimalValueChange($event)"
                />
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-5 col-md-2 text-right">
                <label for="serviceDiscount" class="control-label">Descuento % : </label>
              </div>
              <div class="col-xs-7 col-md-10">
                <input #serviceDiscount="ngModel" name="serviceDiscount" id="serviceDiscount" [(ngModel)]='_serviceDiscount' type="number"
                  placeholder="% de Descuento" min="1" max="99" class="form-control" (keypress)="onPercentageValueChange($event)"
                />
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-5 col-md-2 text-right">
                <label>% de Impuesto : </label>
              </div>
              <div class="col-xs-7 col-md-10">
                <select #serviceTax="ngModel" name="serviceTax" id="serviceTax" [(ngModel)]="_serviceTax" class="form-control" [disabled]="_serviceLock">
                  <option disabled selected [ngValue]="undefined"> Seleccione ... </option>
                  <option *ngFor='let tax of _taxes' [value]="tax.id">{{tax.rate | number: '1.2-2'}} % {{tax.name}}</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-12 col-md-12 text-right">
                <button type="button" class="btn btn-default btn-responsive" (click)="addService()">
                  <span class="glyphicon glyphicon-plus"></span> Agregar Linea</button>
              </div>              
            </div>
          </div>
          <!-- Fin Controles de Selección y Filtrado -->
          <!-- Inicio Lista de Servicios Seleccionados -->
          <div class="table-responsive">
            <table id="servicesTable" datatable [dtOptions]='dtOptions' class="table table-striped table-hover" *ngIf='_selectedServices && _selectedServices.length'>
              <!-- Inicio table Headers -->
              <thead>
                <tr>
                  <th>Servicio</th>
                  <th>Cantidad</th>
                  <th>Precio</th>
                  <th>% Descuento</th>
                  <th>Impuesto</th>
                  <th>Total</th>
                  <th data-priority="1">
                    <span class="glyphicon glyphicon-remove"></span>
                  </th>
                </tr>
              </thead>
              <!-- Fin table Headers -->
              <!-- Inicio table Rows -->
              <tbody>
                <tr *ngFor='let service of _selectedServices'>
                  <td>{{service.Servicio}}</td>
                  <td>{{service.Cantidad}}</td>
                  <td>{{service.Precio | currency:_currencyCode:'code':'1.2-2'}}</td>
                  <td>{{service.Descuento | number: '1.2-2'}}</td>
                  <td>{{service.Impuesto | currency:_currencyCode:'code':'1.2-2'}}</td>
                  <td>{{service.Total | currency:_currencyCode:'code':'1.2-2'}}</td>
                  <td>
                    <a (click)="removeService(service)">
                      <span class="glyphicon glyphicon-remove"></span>
                    </a>
                  </td>
                </tr>
              </tbody>
              <!-- Fin table Rows -->
            </table>
          </div>
          <!-- Fin Lista de Servicios Seleccionados -->
          <!-- Inicio Totalización -->
          <div class="form-group">
            <div class="col-xs-6 col-md-6 text-right">
              <label class="control-label" for="dswitch">Descuento Global </label>
            </div>
            <div class="col-xs-6 col-md-6 text-left">
              <label class="switch" id="dswitch">
                <input type="checkbox" #descuentoGlobal="ngModel" name="descuentoGlobal" [(ngModel)]='_descuentoGlobal'>
                <span class="slider round"></span>
              </label>
            </div>
          </div>
          <div class="form-group" *ngIf="_descuentoGlobal">
            <div class="col-xs-2 col-md-5 text-right">
              <label class="control-label" for="globalDiscount">% </label>
            </div>
            <div class="col-xs-6 col-md-6 align-center-middle text-left">
              <input #globalDiscount="ngModel" name="globalDiscount" [(ngModel)]='_globalDiscount' type="number" class="form-control" placeholder="% de Descuento Global"
                (keypress)="onPercentageValueChange($event)" />
            </div>
            <div class="col-xs-4 col-md-1 align-center-middle text-center">
              <button type="button" class="btn btn-default btn-responsive" (click)="onGlobalDiscountChange()">Aplicar</button>
            </div>
          </div>
          <!-- Inicio Totalización -->
          <div class="form-group" *ngIf="!_descuentoGlobal">
            <div class="col-xs-12 col-md-12">
              <pre style="line-height: 1.2em; font-size: 1em; white-space:pre;" class="text-right col-xs-5 col-md-5">
Sub Total :
Descuento :
Impuesto  :
Total     :
              </pre>
              <pre style="line-height: 1.2em; font-size: 1em; white-space:pre;" class="text-right col-xs-7 col-md-7">
{{_invoiceSubTotal | currency:_currencyCode:'code':'1.2-2'}}
{{_invoiceDiscountTotal | currency:_currencyCode:'code':'1.2-2'}}
{{_invoiceTaxTotal | currency:_currencyCode:'code':'1.2-2'}}
{{_invoiceTotal | currency:_currencyCode:'code':'1.2-2'}}
              </pre>
            </div>
          </div>
          <div class="form-group" *ngIf="_descuentoGlobal">
            <div class="col-xs-12 col-md-12">
              <pre style="line-height: 1.2em; font-size: 1em; white-space:pre;" class="text-right col-xs-5 col-md-5">
Sub Total :
Descuento :
Impuesto  :
Total     :
                  </pre>
              <pre style="line-height: 1.2em; font-size: 1em; white-space:pre;" class="text-right col-xs-7 col-md-7">
{{_invoiceSubTotal | currency:_currencyCode:'code':'1.2-2'}}
{{_gdInvoiceDiscountTotal | currency:_currencyCode:'code':'1.2-2'}}
{{_gdInvoiceTaxTotal | currency:_currencyCode:'code':'1.2-2'}}
{{_gdInvoiceTotal | currency:_currencyCode:'code':'1.2-2'}}
                  </pre>
            </div>
          </div>
          <!-- fin Totalización -->
        </div>
        <!-- Fin del Contenido del Panel -->
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading text-center">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" data-target="#panelTipoPago" href="#panelTipoPago" onclick="return false;">
            <span class="glyphicon glyphicon-credit-card"></span> Medios de pago a utilizar</a>
        </h4>
      </div>
      <div id="panelTipoPago" class="panel-collapse collapse indent">
        <div class="panel-body">
          <!-- Inicio Contenido del Panel -->
          <div>
            <!-- Inicio Selección de tipos de pago -->
            <div class="form-group">
              <div class="col-xs-12 col-md-12 text-right" *ngIf="_descuentoGlobal">
                <h4>Total a Pagar : {{_gdInvoiceTotal | currency:_currencyCode:'code':'1.2-2'}}</h4>
              </div>
              <div class="col-xs-12 col-md-12 text-right" *ngIf="!_descuentoGlobal">
                <h4>Total a Pagar : {{_invoiceTotal | currency:_currencyCode:'code':'1.2-2'}}</h4>
              </div>
            </div>
            <!-- Inicio Selección de forma de Pago -->
            <div class="form-group">
              <div class="col-xs-12 col-md-12 text-center">
                <label for="PaymentConditions">Seleccione la condición de Venta :</label>
              </div>
              <div class="col-xs-12 col-md-12 text-center">
                <select #PaymentConditions="ngModel" name="PaymentConditions" id="PaymentConditions" class="form-control" required [(ngModel)]="_invoicePaymentConditionsCredit">
                  <option [ngValue]='false'>Contado</option>
                  <option [ngValue]='true'>Crédito</option>
                </select>
              </div>
            </div>
            <!-- Inicio pago Crédito -->
            <div *ngIf="_invoicePaymentConditionsCredit">
              <div class="form-group">
                <div class="col-xs-12 col-md-12 text-center">
                  <label class="control-label">Pago a crédito :</label>
                </div>
              </div>
              <div class="form-group">
                <div class="col-xs-6 col-md-6 text-right">
                  <label class="control-label" for="invoiceCreditDays">Dias de crédito </label>
                </div>
                <div class="col-xs-6 col-md-6 text-left">
                  <input required #invoiceCreditDays="ngModel" name="invoiceCreditDays" id="invoiceCreditDays" [(ngModel)]='_invoiceCreditDays'
                    type="number" placeholder="ej. 5" class="form-control" min="1" />
                </div>
              </div>
            </div>
            <!-- Fin pago Crédito -->
            <!-- Fin Selección de forma de Pago de contado -->
            <div class="form-group" *ngIf="!_invoicePaymentConditionsCredit">
              <div class="col-xs-12 col-md-12 text-center">
                <label for="paymentType">Seleccione los medios de pago :</label>
              </div>
              <div class="col-xs-12 col-md-12 text-center">
                <div class="checkbox">
                  <label class="checkbox">
                    <input #PaymentCash name="PaymentCash" [(ngModel)]='_invoicePaymentCash' type="checkbox" (change)="invoicePaymentCashChange()">Efectivo</label>
                  <label class="checkbox">
                    <input #PaymentCreditCard name="PaymentCreditCard" type="checkbox" [(ngModel)]='_invoicePaymentCreditCard' (change)="invoicePaymentCreditCardChange()">Tarjeta de Crédito</label>
                  <label class="checkbox">
                    <input #PaymentCheck name="PaymentCheck" type="checkbox" [(ngModel)]='_invoicePaymentCheck' (change)="invoicePaymentCheckChange()">Cheque</label>
                  <label class="checkbox">
                    <input #PaymentDeposit name="PaymentDeposit" type="checkbox" [(ngModel)]='_invoicePaymentDeposit' (change)="invoicePaymentDepositChange()">Depósito / Transferencia</label>
                </div>
              </div>
            </div>
            <!-- Fin Selección de tipos de pago -->
            <!-- Inicio Detalles del pago -->
            <!-- Inicio pago efectivo -->
            <div *ngIf="_invoicePaymentCash && !_invoicePaymentConditionsCredit">
              <div class="form-group">
                <div class="col-xs-12 col-md-12 text-center">
                  <label class="control-label">Pago en Efectivo :</label>
                </div>
              </div>
              <div class="form-group">
                <div class="col-xs-6 col-md-6 text-right">
                  <label class="control-label" for="invoicePaymentCash">Monto </label>
                </div>
                <div class="col-xs-6 col-md-6 text-left">
                  <input required #invoicePaymentCash="ngModel" name="invoicePaymentCash" id="invoicePaymentCash" [(ngModel)]='_invoiceAmountCash'
                    type="number" placeholder="ej. 125.00" class="form-control" (keypress)="onDecimalValueChange($event)" />
                  <!-- lang="en" en-150  es-CR -->
                </div>
              </div>
            </div>
            <!-- Fin pago efectivo -->
            <!-- Inicio pago Tarjeta -->
            <div *ngIf="_invoicePaymentCreditCard  && !_invoicePaymentConditionsCredit">
              <div class="form-group">
                <div class="col-xs-12 col-md-12 text-center">
                  <label class="control-label">Pago en Tarjeta :</label>
                </div>
              </div>
              <div class="form-group">
                <div class="col-xs-6 col-md-6 text-right">
                  <label class="control-label" for="invoicePaymentCreditCard">Monto </label>
                </div>
                <div class="col-xs-6 col-md-6 text-left">
                  <input required #invoicePaymentCreditCard="ngModel" name="invoicePaymentCreditCard" id="invoicePaymentCreditCard" [(ngModel)]='_invoiceamountCreditCard'
                    type="number" placeholder="ej. 125.00" class="form-control" (keypress)="onDecimalValueChange($event)" />
                </div>
              </div>
              <div class="form-group">
                <div class="col-xs-6 col-md-6 text-right">
                  <label class="control-label" for="invoiceTransNumberCreditCard">Nro. de Transacción </label>
                </div>
                <div class="col-xs-6 col-md-6 text-left">
                  <input required #invoiceTransNumberCreditCard="ngModel" name="invoiceTransNumberCreditCard" id="invoiceTransNumberCreditCard"
                    [(ngModel)]='_invoiceTransNumberCreditCard' type="text" placeholder="#" class="form-control" pattern="[A-Za-z0-9]+"
                  />
                </div>
              </div>
            </div>
            <!-- Fin pago Tarjeta -->
            <!-- Inicio pago Cheque -->
            <div *ngIf="_invoicePaymentCheck  && !_invoicePaymentConditionsCredit">
              <div class="form-group">
                <div class="col-xs-12 col-md-12 text-center">
                  <label class="control-label">Pago en Cheque :</label>
                </div>
              </div>
              <div class="form-group">
                <div class="col-xs-6 col-md-6 text-right">
                  <label class="control-label" for="invoicePaymentCheck">Monto </label>
                </div>
                <div class="col-xs-6 col-md-6 text-left">
                  <input required #invoicePaymentCheck="ngModel" name="invoicePaymentCheck" id="invoicePaymentCheck" [(ngModel)]='_invoiceAmountCheck'
                    type="number" placeholder="ej. 125.00" class="form-control" (keypress)="onDecimalValueChange($event)" />
                </div>
              </div>
              <div class="form-group">
                <div class="col-xs-6 col-md-6 text-right">
                  <label class="control-label" for="invoiceTransNumberCheck">Nro. de Cheque </label>
                </div>
                <div class="col-xs-6 col-md-6 text-left">
                  <input required #invoiceTransNumberCheck="ngModel" name="invoiceTransNumberCheck" id="invoiceTransNumberCheck" [(ngModel)]='_invoiceTransNumberCheck'
                    type="text" placeholder="#" class="form-control" pattern="[A-Za-z0-9]+" />
                </div>
              </div>
            </div>
            <!-- Fin pago Cheque -->
            <!-- Inicio pago Deposito -->
            <div *ngIf="_invoicePaymentDeposit  && !_invoicePaymentConditionsCredit">
              <div class="form-group">
                <div class="col-xs-12 col-md-12 text-center">
                  <label class="control-label">Pago en Depósito / Transferencia :</label>
                </div>
              </div>
              <div class="form-group">
                <div class="col-xs-6 col-md-6 text-right">
                  <label class="control-label" for="invoicePaymentDeposit">Monto </label>
                </div>
                <div class="col-xs-6 col-md-6 text-left">
                  <input required #invoicePaymentDeposit="ngModel" name="invoicePaymentDeposit" id="invoicePaymentDeposit" [(ngModel)]='_invoiceAmountDeposit'
                    type="number" placeholder="ej. 125.00" class="form-control" (keypress)="onDecimalValueChange($event)" />
                </div>
              </div>
              <div class="form-group">
                <div class="col-xs-6 col-md-6 text-right">
                  <label class="control-label" for="invoiceTransNumberDeposit">Nro. de Depósito / Transferencia </label>
                </div>
                <div class="col-xs-6 col-md-6 text-left">
                  <input required #invoiceTransNumberDeposit="ngModel" name="invoiceTransNumberDeposit" id="invoiceTransNumberDeposit" [(ngModel)]='_invoiceTransNumberDeposit'
                    type="text" placeholder="#" class="form-control" pattern="[A-Za-z0-9]+" />
                </div>
              </div>
            </div>
            <!-- Fin pago Deposito -->
            <!-- Fin Detalles del pago -->
          </div>
        </div>
        <!-- Fin Contenido del Panel -->
      </div>
    </div>
    <div class="form-group text-right" style="padding: 10px 1px;">
      <div class="col-xs-6 col-md-6 text-center">
        <button type="button" class="btn btn-lg btn-primary btn-responsive" [disabled]="!(_invoicePaymentCash || _invoicePaymentCreditCard || _invoicePaymentCheck || _invoicePaymentDeposit || this._invoicePaymentConditionsCredit) || !this._userSelectedService || !createInvoiceForm.form.valid"
          type="submit">
          <span class="glyphicon glyphicon-cloud-upload"></span> Facturar</button>
      </div>
      <div class="col-xs-6 col-md-6 text-center">
        <button type="button" class="btn btn-lg btn-primary btn-responsive" type="button" (click)="returnToIndex()">
          <span class="glyphicon glyphicon-remove"></span> Cancelar</button>
      </div>
    </div>
  </div>
</form>